<!DOCTYPE html>
<html lang=en>
    <head>
        <title>rje.li</title>
        <style>
        body {
            max-width: 800px;
            margin-left: 40px;
            margin-right: 40px;
            font-family: serif;
        }
        </style>
    </head>
    <body>
        <h1>Ugly debian packaging: Just put my binary in a .deb, dammit</h1>

<p>I recently wanted to put some shared libraries and executables in <code class="language-plaintext highlighter-rouge">.deb</code> files, so end-users could just <code class="language-plaintext highlighter-rouge">apt install ./the-package.deb</code>. This task is straightforward but it’s surprisingly hard to find instructions. I found Vincent Bernat’s <a href="https://vincent.bernat.ch/en/blog/2019-pragmatic-debian-packaging">Pragmatic Debian packaging</a> quite useful, and I recommend you go read that first. However, his methods are still too reasonable and maintainable for me. I just want to put my binary in a .deb, dammit.</p>

<p>Assume we work at a company called CoolSoft. CoolSoft has a program called <code class="language-plaintext highlighter-rouge">sayhi</code> that says hi. It can be a binary, shell script, whatever.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./sayhi
hi
</code></pre></div></div>

<p>We would like to install it into <code class="language-plaintext highlighter-rouge">/usr/local/bin</code>. First create a script called <code class="language-plaintext highlighter-rouge">make_sayhi_deb.sh</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nb">set</span> <span class="nt">-euo</span> pipefail

<span class="nv">pkgname</span><span class="o">=</span>sayhi
<span class="nv">version</span><span class="o">=</span>0.0.1
<span class="nb">arch</span><span class="o">=</span>all

<span class="nv">tmpdir</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="nt">-d</span><span class="si">)</span>
<span class="nv">pkgdir</span><span class="o">=</span><span class="nv">$tmpdir</span>/pkg
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$pkgdir</span> <span class="nv">$pkgdir</span>/DEBIAN 

<span class="c"># this is the part where it installs your files</span>
<span class="nb">install</span> <span class="nt">-Dm</span> 755 sayhi <span class="nv">$pkgdir</span>/usr/local/bin/sayhi

<span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOF</span><span class="sh"> &gt;</span><span class="nv">$pkgdir</span><span class="sh">/DEBIAN/control
Package: </span><span class="nv">$pkgname</span><span class="sh">
Version: </span><span class="nv">$version</span><span class="sh">
Architecture: </span><span class="nv">$arch</span><span class="sh">
Maintainer: CoolSoft (admin@coolsoft.com)
Description: It says hi
Depends:
</span><span class="no">
EOF
</span>dpkg <span class="nt">-b</span> <span class="nv">$pkgdir</span> ./<span class="k">${</span><span class="nv">pkgname</span><span class="k">}</span>_<span class="k">${</span><span class="nv">version</span><span class="k">}</span>_<span class="k">${</span><span class="nv">arch</span><span class="k">}</span>.deb
<span class="nb">rm</span> <span class="nt">-rf</span> <span class="nv">$tmpdir</span>
</code></pre></div></div>

<p>Then just run it and install the package.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>bash make_sayhi_deb.sh
dpkg-deb: building package <span class="s1">'sayhi'</span> <span class="k">in</span> <span class="s1">'./sayhi_0.0.1_all.deb'</span><span class="nb">.</span>
<span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install</span> ./sayhi_0.0.1_all.deb
...
<span class="nv">$ </span>sayhi
hi
</code></pre></div></div>

<p><strong>Architectures</strong>: My <code class="language-plaintext highlighter-rouge">sayhi</code> is actually a shell script, so I chose <code class="language-plaintext highlighter-rouge">arch=all</code> above. If yours is a binary, set it to <code class="language-plaintext highlighter-rouge">amd64</code>, <code class="language-plaintext highlighter-rouge">arm64</code>, or another <a href="https://wiki.debian.org/SupportedArchitectures">Debian architecture</a>.</p>

<p><strong>More files</strong>: See above where it says <code class="language-plaintext highlighter-rouge"># this is the part where it installs your files</code>? Well, just keep installing your other files. 755 for executables, 644 otherwise. <code class="language-plaintext highlighter-rouge">-D</code> creates leading folders automatically.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># this is the part where it installs your files</span>
<span class="nb">install</span> <span class="nt">-Dm</span> 755 sayhi <span class="nv">$pkgdir</span>/usr/local/bin/sayhi
<span class="nb">install</span> <span class="nt">-Dm</span> 644 libsayhi.so <span class="nv">$pkgdir</span>/usr/local/lib/libsayhi.so
</code></pre></div></div>



<p>
    <a href='/'>← back</a>
</p>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true
    }
});
</script>
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

        <script data-goatcounter="https://rjeli.goatcounter.com/count"
            async src="//gc.zgo.at/count.js"></script>
    </body>
</html>
